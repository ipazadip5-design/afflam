import{r as i,j as e,s as E,a as xt,f as gt,R as jt}from"./index-ys7-kEXr.js";import{p as Ie}from"./proxiedFetch-kRjwpW2b.js";import{P as dt}from"./Pagination-CZV0YIFB.js";import{F as Ee,S as Ne}from"./SpinnerIcon--GOSBvL4.js";const vt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],ht=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Nt=({onSubmit:o,initialData:r,onCancel:u,isLoading:c=!1,allGenres:b=[]})=>{var ee,le,re;const[s,d]=i.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"FullHD"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),[y,v]=i.useState(""),[T,D]=i.useState(""),[V,te]=i.useState(!1),[C,O]=i.useState(""),[K,M]=i.useState(!1),[S,U]=i.useState(""),[j,$]=i.useState(""),[B,q]=i.useState(!1),p=i.useRef(null);i.useEffect(()=>{if(r){let n=r.movie_type;!n&&r.is_kurdish&&(n="kurdish"),d({title:r.title||"",description:r.description||"",poster_url:r.poster_url||"",backdrop_url:r.backdrop_url||"",year:r.year||new Date().getFullYear(),genres:r.genres||[],tags:r.tags||[],servers:r.servers&&r.servers.length>0?r.servers:[{name:"Server 1",url:"",quality:"FullHD"}],backup_servers:r.backup_servers||[],download_url:r.download_url||"",trailer_url:r.trailer_url||"",is_kurdish:n==="kurdish",movie_type:n||"foreign",imdb_rating:r.imdb_rating,quality:r.quality||"",duration:r.duration||"",language:r.language||"",country:r.country||"",directors:r.directors||[],writers:r.writers||[],cast:r.cast||[]}),v((r.tags||[]).join(", "))}else d({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"FullHD"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),v("")},[r]),i.useEffect(()=>{const n=t=>{p.current&&!p.current.contains(t.target)&&M(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]),i.useEffect(()=>{if(!r){const n=s.title.match(/\b(19[89]\d|20\d{2})\b/);if(n&&n[0]){const t=parseInt(n[0],10),l=s.title.replace(n[0],"").replace(/\s\s+/g," ").trim();d(g=>g.year!==t||g.title!==l?{...g,year:t,title:l}:g)}}},[s.title,r]),i.useEffect(()=>{!r&&!s.backdrop_url.trim()&&d(n=>({...n,backdrop_url:n.poster_url}))},[s.poster_url,r,s.backdrop_url]),i.useEffect(()=>{const n=s.download_url;if(n&&n.includes("vidtube.pro/d/")){const t=n.match(/vidtube\.pro\/d\/([a-zA-Z0-9]+)\.html/);if(t&&t[1]){const g=`https://vidtube.pro/embed-${t[1]}.html`;if(s.servers.length>0&&s.servers[0].url!==g){const w=[...s.servers];w[0]={...w[0],url:g},d(A=>({...A,servers:w}))}else if(s.servers.length===0){const w={name:"Server 1",url:g,quality:"FullHD"};d(A=>({...A,servers:[w]}))}}}},[s.download_url]);const G=async n=>{var t;try{if(!((t=navigator.clipboard)!=null&&t.readText))throw new Error("Clipboard API not available.");const l=await navigator.clipboard.readText();l&&n(l)}catch(l){console.error("Failed to read clipboard contents: ",l),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},m=n=>{const{name:t,value:l,type:g}=n.target;if(g==="checkbox"){const{checked:w}=n.target;d(A=>({...A,[t]:w}))}else if(t==="year"){const w=parseInt(l,10);d(A=>({...A,[t]:isNaN(w)?0:w}))}else if(t==="imdb_rating"){const w=parseFloat(l);d(A=>({...A,imdb_rating:isNaN(w)?void 0:w}))}else d(w=>({...w,[t]:l}))},h=n=>{v(n.target.value)},x=n=>{d(t=>{const l=t.genres||[],g=l.includes(n)?l.filter(w=>w!==n):[...l,n];return{...t,genres:g}})},_=async()=>{const n=j.trim();if(n){if(b.some(t=>t.toLowerCase()===n.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}q(!0);try{const{error:t}=await E.from("categories").insert({name:n});if(t)throw t;d(l=>({...l,genres:[...l.genres||[],n]})),$("")}catch(t){console.error("Error adding new genre:",t),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{q(!1)}}},F=(n,t,l)=>{const g=[...s.servers];g[n]={...g[n],[t]:l},d(w=>({...w,servers:g}))},W=()=>{d(n=>{const t={name:`Server ${n.servers.length+1}`,url:"",quality:"FullHD"};return{...n,servers:[...n.servers,t]}})},Z=n=>{d(t=>({...t,servers:t.servers.filter((l,g)=>g!==n)}))},R=(n,t,l)=>{const g=[...s.backup_servers||[]];g[n]={...g[n],[t]:l},d(w=>({...w,backup_servers:g}))},ke=()=>{d(n=>{var t;return{...n,backup_servers:[...n.backup_servers||[],{name:`Server ${(((t=n.backup_servers)==null?void 0:t.length)||0)+1}`,url:"",quality:"FullHD",no_sub_url:""}]}})},ue=n=>{d(t=>({...t,backup_servers:(t.backup_servers||[]).filter((l,g)=>g!==n)}))},N=async()=>{var n,t,l,g,w,A,J,ae,me,a,f,k,H,ge,we,je,ve,pe,$e;if(!T){O("Please enter a URL.");return}te(!0),O("");try{O("Fetching movie page...");const Fe=await Ie(T);if(!Fe.ok)throw new Error(`Failed to fetch URL: ${Fe.statusText}`);const yt=await Fe.text(),mt=new DOMParser,ne=mt.parseFromString(yt,"text/html");if(T.includes("a.asd.homes")){O("جلب البيانات من عرب سيد...");const oe=X=>{var se,qe;const Q=Array.from(ne.querySelectorAll(".info__area__ul > li")).find(he=>{var xe,rt;return(rt=(xe=he.querySelector(".title__kit span"))==null?void 0:xe.textContent)==null?void 0:rt.trim().startsWith(X)});if(!Q)return[];const ce=Array.from(Q.querySelectorAll("ul.tags__list a"));if(ce.length>0)return ce.map(he=>{var xe;return((xe=he.textContent)==null?void 0:xe.trim())||""}).filter(Boolean);const de=Array.from(Q.childNodes).find(he=>{var xe;return he.nodeType===Node.TEXT_NODE&&((xe=he.textContent)==null?void 0:xe.trim())});if(de)return[((se=de.textContent)==null?void 0:se.trim())||""];const P=Q.querySelector("a");return P?[((qe=P.textContent)==null?void 0:qe.trim())||""]:[]},Me=((t=(n=ne.querySelector("h1.post__name"))==null?void 0:n.textContent)==null?void 0:t.trim())||"",be=Me.match(/\(\s*(\d{4})\s*\)/),Ve=be?parseInt(be[1],10):new Date().getFullYear(),ye=be?Me.replace(be[0],"").trim():Me,Je=((g=(l=ne.querySelector(".post__story p"))==null?void 0:l.textContent)==null?void 0:g.trim())||"",Ae=((w=ne.querySelector(".poster__single img"))==null?void 0:w.getAttribute("data-src"))||((A=ne.querySelector(".poster__single img"))==null?void 0:A.getAttribute("src"))||"",Xe=((ae=(J=ne.querySelector(".rating__box .rate__txt"))==null?void 0:J.textContent)==null?void 0:ae.trim().split("/")[0].trim())||"0",Ke=parseFloat(Xe)||void 0,Ze=oe("نوع العرض"),Qe=oe("جودة العرض").join(", "),et=oe("مدة العرض").join(", "),tt=oe("لغة العرض").join(", "),st=oe("بلد العرض").join(", "),Pe=[],De=[],Le=[];ne.querySelectorAll(".persons__list li a").forEach(X=>{var ce,de,P,se;const ie=(de=(ce=X.querySelector(".name"))==null?void 0:ce.textContent)==null?void 0:de.trim(),Q=(se=(P=X.querySelector(".role"))==null?void 0:P.textContent)==null?void 0:se.trim();ie&&Q&&(Q.includes("مخرج")?Pe.push(ie):Q.includes("كاتب")?De.push(ie):Le.push(ie))});const Be=((me=ne.querySelector(".show__trailer"))==null?void 0:me.getAttribute("data-iframe"))||"",Te=async X=>{var ie;if(!X)return"";try{O("Fetching watch page...");const Q=await Ie(X);if(!Q.ok)throw new Error(`Failed to fetch watch page: ${Q.statusText}`);const ce=await Q.text(),P=(ie=new DOMParser().parseFromString(ce,"text/html").querySelector(".player__iframe iframe"))==null?void 0:ie.getAttribute("src");return P?P.startsWith("/")?`https://a.asd.homes${P}`:new URL(P,X).href:""}catch(Q){return console.error("Error scraping watch page:",Q),O("Warning: Could not automatically find watch server."),""}},Re=(X,ie,Q)=>new Promise(async(ce,de)=>{if(!X)return ce("");let P=null,se=null;const qe=setTimeout(()=>{se==null||se.disconnect(),P==null||P.remove(),de(new Error(`Scraping timed out for ${X}`))},15e3);try{const he=await Ie(X);if(!he.ok)return de(new Error(`Failed to fetch intermediate page: ${X}`));const xe=await he.text(),at=new DOMParser().parseFromString(xe,"text/html").querySelector(ie);if(at&&at.getAttribute(Q))return clearTimeout(qe),ce(at.getAttribute(Q)||"");P=document.createElement("div"),P.style.display="none",document.body.appendChild(P),se=new MutationObserver(()=>{const lt=P==null?void 0:P.querySelector(ie);if(lt&&lt.getAttribute(Q)){const wt=lt.getAttribute(Q)||"";se==null||se.disconnect(),clearTimeout(qe),P==null||P.remove(),ce(wt)}}),se.observe(P,{childList:!0,subtree:!0}),P.innerHTML=xe}catch(he){clearTimeout(qe),se==null||se.disconnect(),P==null||P.remove(),de(he)}});O("Fetching watch & download pages (this may take a moment)...");const fe=(a=ne.querySelector("a.watch__btn"))==null?void 0:a.getAttribute("href"),Ue=(f=ne.querySelector("a.download__btn"))==null?void 0:f.getAttribute("href"),[Ce,Ge]=await Promise.all([Te(fe),Re(Ue,'a.downloadsLink, a[href*="vidtube.pro/d/"], .downloads__links__list a',"href").catch(X=>(console.warn("Could not scrape download URL:",X),O("Warning: Could not automatically find download link."),""))]);let Se=[];Ce&&(O("Parsing watch servers..."),Se.push({name:"Server 1",url:Ce,quality:"HD"})),d(X=>({...X,title:ye,year:Ve||X.year,description:Je,poster_url:Ae,backdrop_url:Ae,imdb_rating:Ke,genres:[...new Set([...X.genres,...Ze])],quality:Qe,duration:et,language:tt,country:st,directors:Pe,writers:De,cast:Le,trailer_url:Be,servers:Se.length>0?Se:X.servers,download_url:Ge||X.download_url})),O("تم جلب البيانات بنجاح!")}else if(T.includes("topcinema.cam")){const oe=fe=>{var ie,Q,ce;const Ce=Array.from(ne.querySelectorAll(".RightTaxContent > li")).find(de=>{var P,se;return(se=(P=de.querySelector("span"))==null?void 0:P.textContent)==null?void 0:se.trim().startsWith(fe)});if(!Ce)return[];const Ge=Array.from(Ce.querySelectorAll("a, strong"));if(Ge.length>0)return Ge.map(de=>{var P;return((P=de.textContent)==null?void 0:P.trim())||""}).filter(Boolean);const Se=Ce.cloneNode(!0);(ie=Se.querySelector("i"))==null||ie.remove(),(Q=Se.querySelector("span"))==null||Q.remove();const X=(ce=Se.textContent)==null?void 0:ce.trim().replace(/^:/,"").trim();return X?X.split(/\s*,\s*/):[]},Me=((H=(k=ne.querySelector("h1.post-title"))==null?void 0:k.textContent)==null?void 0:H.trim())||"",be=Me.match(/\b(19\d{2}|20\d{2})\b/),Ve=be?parseInt(be[0],10):new Date().getFullYear();let ye=Me;ye=ye.replace(/فيلم|مترجم|اون لاين|اونلاين|WEB-DL|BluRay|HD/gi,"").replace(/[\u0600-\u06FF]+/g,""),be&&(ye=ye.replace(be[0],"")),ye=ye.trim().replace(/^[^a-zA-Z0-9\s]+|[^a-zA-Z0-9\s]+$/g,"").trim();const Je=((we=(ge=ne.querySelector(".story p"))==null?void 0:ge.textContent)==null?void 0:we.trim())||"",Ae=((je=ne.querySelector(".MainSingle .left .image img"))==null?void 0:je.getAttribute("src"))||"",Xe=((pe=(ve=ne.querySelector(".imdbR span"))==null?void 0:ve.textContent)==null?void 0:pe.trim())||"0",Ke=parseFloat(Xe)||void 0,Ze=oe("نوع الفيلم"),Qe=oe("جودة الفيلم").join(", "),et=oe("توقيت الفيلم").join(", "),tt=oe("لغة الفيلم").join(", "),st=oe("دولة الفيلم").join(", "),Pe=oe("المخرجين"),De=oe("المؤلفين"),Le=oe("بطولة");let Be="";const Te=ne.querySelector("a.download"),Re=Te==null?void 0:Te.getAttribute("href");if(Re){O("Fetching download link...");const fe=await Ie(Re);if(fe.ok){const Ue=await fe.text();Be=(($e=mt.parseFromString(Ue,"text/html").querySelector('a.downloadsLink, a[href*="vidtube.pro/d/"]'))==null?void 0:$e.getAttribute("href"))||""}}d(fe=>({...fe,title:ye,year:Ve||fe.year,description:Je,poster_url:Ae,backdrop_url:Ae,imdb_rating:Ke,genres:[...new Set([...fe.genres,...Ze])],quality:Qe,duration:et,language:tt,country:st,directors:Pe,writers:De,cast:Le,download_url:Be})),O("تم جلب البيانات بنجاح!")}else{O("هذا الموقع غير مدعوم حاليًا للجلب."),te(!1);return}}catch(Fe){console.error("Scraping failed:",Fe),O(`فشل جلب البيانات: ${Fe.message}.`)}finally{te(!1)}},L=n=>{if(n.preventDefault(),s.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const t=y.split(",").map(g=>g.trim()).filter(Boolean),l={...s,tags:t,is_kurdish:s.movie_type==="kurdish"};o(l)},z=b.filter(n=>n.toLowerCase().includes(S.toLowerCase())),Y="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",I="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[e.jsx("label",{htmlFor:"scrape_url",className:"block text-lg font-semibold text-white",children:"جلب البيانات من رابط"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{id:"scrape_url",type:"url",value:T,onChange:n=>D(n.target.value),placeholder:"https://web6.topcinema.cam/... or https://a.asd.homes/...",className:`${Y} flex-grow`}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>d(n=>({...n,download_url:T})),title:"لصق رابط الجلب في حقل رابط التحميل",className:"bg-slate-600 text-white font-bold py-2 px-3 rounded-lg hover:bg-slate-500 transition-colors flex-grow sm:flex-grow-0 flex items-center justify-center text-sm",children:"تحميل"}),e.jsxs("button",{type:"button",onClick:N,disabled:V,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 flex-shrink-0 flex-grow sm:flex-grow-0 flex items-center justify-center disabled:bg-slate-500",children:[V&&e.jsx(ht,{}),V?"جاري الجلب...":"جلب البيانات"]})]})]}),C&&e.jsx("p",{className:`text-sm mt-1 ${C.startsWith("فشل")||C.startsWith("هذا")?"text-red-400":"text-green-400"}`,children:C})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:s.title,onChange:m,placeholder:"عنوان الفيلم (بالانجليزية)",required:!0,className:Y})}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:m,placeholder:"سنة الإنتاج",required:!0,className:Y})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:m,placeholder:"وصف الفيلم",required:!0,className:`${Y} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:m,placeholder:"رابط صورة البوستر",required:!0,className:`${Y} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>G(n=>d(t=>({...t,poster_url:n,backdrop_url:n}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-2 px-4 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:m,placeholder:"رابط صورة الخلفية",required:!0,className:Y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:m,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:Y}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:m,placeholder:"رابط المقطع الدعائي (اختياري)",className:Y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"movie_type",className:"block text-sm font-medium text-slate-300 mb-2",children:"نوع الفيلم"}),e.jsx("select",{id:"movie_type",name:"movie_type",value:s.movie_type||"foreign",onChange:m,className:Y,children:vt.map(n=>e.jsx("option",{value:n.key,children:n.label},n.key))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-slate-300 mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:y,onChange:h,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:Y})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:p,children:[e.jsxs("button",{type:"button",onClick:()=>M(n=>!n),className:`${Y} text-right flex justify-between items-center`,children:[e.jsx("span",{children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${K?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),K&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:S,onChange:n=>U(n.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:z.map(n=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(n),onChange:()=>x(n),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:n})]},n))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:j,onChange:n=>$(n.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:_,disabled:B||!j.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:B?"...":"إضافة"})]})})]})]})]}),e.jsxs("details",{className:"bg-slate-900/30 p-4 rounded-lg border border-slate-700",open:!0,children:[e.jsx("summary",{className:"text-lg font-semibold text-white cursor-pointer",children:"تفاصيل إضافية للفيلم"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"quality",value:s.quality,onChange:m,placeholder:"الجودة (e.g. 1080p WEB-DL)",className:I}),e.jsx("input",{type:"text",name:"duration",value:s.duration,onChange:m,placeholder:"مدة العرض",className:I}),e.jsx("input",{type:"text",name:"language",value:s.language,onChange:m,placeholder:"اللغة",className:I}),e.jsx("input",{type:"text",name:"country",value:s.country,onChange:m,placeholder:"الدولة",className:I})]}),e.jsx("textarea",{value:(ee=s.directors)==null?void 0:ee.join(", "),onChange:n=>d(t=>({...t,directors:n.target.value.split(",").map(l=>l.trim())})),placeholder:"المخرجين (مفصولة بفاصلة)",className:`${I} w-full`,rows:2}),e.jsx("textarea",{value:(le=s.writers)==null?void 0:le.join(", "),onChange:n=>d(t=>({...t,writers:n.target.value.split(",").map(l=>l.trim())})),placeholder:"المؤلفين (مفصولة بفاصلة)",className:`${I} w-full`,rows:2}),e.jsx("textarea",{value:(re=s.cast)==null?void 0:re.join(", "),onChange:n=>d(t=>({...t,cast:n.target.value.split(",").map(l=>l.trim())})),placeholder:"البطولة (مفصولة بفاصلة)",className:`${I} w-full`,rows:3})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),s.servers.map((n,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:l=>F(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${I} flex-1`}),e.jsxs("select",{value:n.quality,onChange:l=>F(t,"quality",l.target.value),className:`${I} w-28`,children:[e.jsx("option",{value:"FullHD",children:"FullHD"}),e.jsx("option",{value:"HD",children:"HD"}),e.jsx("option",{value:"SD",children:"SD"})]}),s.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>Z(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),t===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>F(t,"url",l.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${I} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>G(l=>F(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"download_url",value:s.download_url||"",onChange:m,placeholder:"رابط صفحة الفيلم (لجلب التحميلات)",className:`${I} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>G(l=>d(g=>({...g,download_url:l}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>F(t,"url",l.target.value),placeholder:`رابط السيرفر ${t+1}`,required:!0,className:`${I} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>G(l=>F(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]},t)),e.jsx("button",{type:"button",onClick:W,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(s.backup_servers||[]).map((n,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:l=>R(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${I} flex-1`}),e.jsxs("select",{value:n.quality,onChange:l=>R(t,"quality",l.target.value),className:`${I} w-28`,children:[e.jsx("option",{value:"FullHD",children:"FullHD"}),e.jsx("option",{value:"HD",children:"HD"}),e.jsx("option",{value:"SD",children:"SD"})]}),e.jsx("button",{type:"button",onClick:()=>ue(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>R(t,"url",l.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${I} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>G(l=>R(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.no_sub_url||"",onChange:l=>R(t,"no_sub_url",l.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${I} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>G(l=>R(t,"no_sub_url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]})]},t)),e.jsx("button",{type:"button",onClick:ke,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]})]}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-slate-800/95 backdrop-blur-sm p-4 border-t border-slate-700 flex justify-end gap-4 -mx-6 -mb-6 md:-mx-8 md:-mb-8 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:c,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:c,children:[c&&e.jsx(ht,{}),c?r?"جاري التحديث...":"جاري الإضافة...":r?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},kt=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),_e=({isOpen:o,onClose:r,onConfirm:u,title:c,message:b,isLoading:s=!1})=>{const[d,y]=i.useState(o);return i.useEffect(()=>{if(o)y(!0);else{const v=setTimeout(()=>y(!1),300);return()=>clearTimeout(v)}},[o]),d?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${o?"animate-fade-in":"animate-fade-out"}`,onClick:r,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${o?"animate-zoom-in":"animate-zoom-out"}`,onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:c}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:b})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:u,disabled:s,children:[s&&e.jsx(kt,{}),s?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:r,disabled:s,children:"إلغاء"})]})]})}):null},Ct=10,pt=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((o,r)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},r))})}),e.jsx("tbody",{children:[...Array(Ct)].map((o,r)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((u,c)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},c))]},r))})]})})]}),ut=({message:o,type:r,onClose:u})=>(i.useEffect(()=>{const s=setTimeout(u,5e3);return()=>clearTimeout(s)},[u]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${r==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:o}),e.jsx("button",{onClick:u,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),ft=({genres:o,onSubmit:r,onClose:u,isLoading:c})=>{const[b,s]=i.useState(o[0]||""),[d,y]=i.useState("add"),v=T=>{T.preventDefault(),b&&r(b,d)};return e.jsx(Ee,{title:"تغيير الفئة بشكل جماعي",onClose:u,isOpen:!0,children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:b,onChange:T=>s(T.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:o.map(T=>e.jsx("option",{value:T,children:T},T))}),e.jsxs("select",{value:d,onChange:T=>y(T.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:u,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c||!b,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(Ne,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},St=({onSubmit:o,onClose:r,isLoading:u})=>{const[c,b]=i.useState(new Date().getFullYear()),s=d=>{d.preventDefault(),o(c)};return e.jsx(Ee,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:r,isOpen:!0,children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:c,onChange:d=>b(parseInt(d.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(Ne,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},bt=({onSubmit:o,onClose:r,isLoading:u})=>{const[c,b]=i.useState(""),[s,d]=i.useState("add"),y=v=>{v.preventDefault(),c.trim()&&o(c.trim(),s)};return e.jsx(Ee,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:r,isOpen:!0,children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:c,onChange:v=>b(v.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:s,onChange:v=>d(v.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!c.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(Ne,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},_t=({movieTypes:o,onSubmit:r,onClose:u,isLoading:c})=>{var y;const[b,s]=i.useState(((y=o[0])==null?void 0:y.key)||"foreign"),d=v=>{v.preventDefault(),r(b)};return e.jsx(Ee,{title:"تغيير نوع الفيلم بشكل جماعي",onClose:u,isOpen:!0,children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر النوع الجديد ليتم تطبيقه على جميع الأفلام المحددة."}),e.jsx("select",{value:b,onChange:v=>s(v.target.value),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:o.map(v=>e.jsx("option",{value:v.key,children:v.label},v.key))}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:u,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(Ne,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ze=10,nt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],Et=async()=>{let o=[],r=0;const u=1e3;for(;;){const{data:c,error:b}=await E.from("movies").select("*").order("created_at",{ascending:!1}).range(r,r+u-1);if(b)throw console.error("Error fetching a batch of movies for admin: ",b.message),b;if(c&&c.length>0){if(o=o.concat(c),c.length<u)break;r+=c.length}else break}return o},$t=()=>{const[o,r]=i.useState([]),[u,c]=i.useState(null),[b,s]=i.useState(!1),[d,y]=i.useState(1),[v,T]=i.useState("all"),[D,V]=i.useState(""),[te,C]=i.useState(!1),[O,K]=i.useState(null),[M,S]=i.useState(!0),[U,j]=i.useState(!1),[$,B]=i.useState(null),[q,p]=i.useState([]),[G,m]=i.useState(null),[h,x]=i.useState([]),[_,F]=xt(),W=i.useRef(!1),Z=async()=>{var k;try{const H=await Et();r(H)}catch(H){let ge="فشل في تحميل الأفلام.";H.code==="42501"?ge="فشل تحميل الأفلام: أذونات غير كافية.":(k=H.message)!=null&&k.toLowerCase().includes("network")&&(ge="فشل تحميل الأفلام: مشكلة في الشبكة."),R(ge,"error"),console.error("Error fetching movies: ",H)}const{data:a,error:f}=await E.from("categories").select("name").order("name");f?console.error("Error fetching categories from ManageMovies: ",f):x(a.map(H=>H.name)),S(!1)};i.useEffect(()=>{S(!0),Z();const a=E.channel("admin-movies-changes").on("postgres_changes",{event:"*",schema:"public",table:"movies"},()=>Z()).subscribe();return()=>{E.removeChannel(a)}},[]),i.useEffect(()=>{if(M||W.current)return;const a=_.get("edit");if(a&&o.length>0){const f=o.find(k=>k.id===a);f&&(z(f),_.delete("edit"),F(_,{replace:!0}),W.current=!0)}},[_,F,o,M]),i.useEffect(()=>{y(1),p([])},[v,D]);const R=(a,f)=>{B({message:a,type:f})},ke=async a=>{j(!0);try{const{error:f}=await E.from("movies").insert([{...a,created_at:new Date().toISOString()}]);if(f)throw f;await Z(),s(!1),y(1),R("تمت إضافة الفيلم بنجاح.","success")}catch(f){console.error("Error adding movie: ",f);let k="حدث خطأ أثناء إضافة الفيلم.";f.code==="23505"?k=`فشل الإضافة: ${f.details||"يوجد فيلم بنفس البيانات بالفعل."}`:f.code==="42501"?k="فشل الإضافة: أذونات غير كافية. تحقق من قواعد الأمان.":k=`حدث خطأ أثناء إضافة الفيلم: ${f.message}`,R(k,"error")}finally{j(!1)}},ue=async(a,f)=>{j(!0);try{const{error:k}=await E.from("movies").update(f).eq("id",a);if(k)throw k;await Z(),c(null),s(!1),R("تم تحديث الفيلم بنجاح.","success")}catch(k){console.error("Error updating movie: ",k);let H="حدث خطأ أثناء تحديث الفيلم.";k.code==="23505"?H=`فشل التحديث: ${k.details||"يوجد فيلم آخر بنفس البيانات."}`:k.code==="42501"?H="فشل التحديث: أذونات غير كافية. تحقق من قواعد الأمان.":H=`حدث خطأ أثناء تحديث الفيلم: ${k.message}`,R(H,"error")}finally{j(!1)}},N=a=>{K(a),C(!0)},L=async()=>{if(O){j(!0);try{const{error:a}=await E.from("movies").delete().eq("id",O.id);if(a)throw a;R("تم حذف الفيلم بنجاح.","success"),await Z()}catch(a){console.error("Error deleting movie: ",a);let f="حدث خطأ أثناء حذف الفيلم.";a.code==="42501"?f="فشل الحذف: أذونات غير كافية. تحقق من قواعد الأمان.":f=`حدث خطأ أثناء حذف الفيلم: ${a.message}`,R(f,"error")}finally{C(!1),K(null),j(!1)}}},z=a=>{c(a),s(!0)},Y=()=>{c(null),s(!0)},I=()=>{c(null),s(!1),m(null)},ee=a=>{p(f=>f.includes(a)?f.filter(k=>k!==a):[...f,a])},le=a=>{a.target.checked?p(J.map(f=>f.id)):p(q.filter(f=>!J.some(k=>k.id===f)))},re=async(a,f)=>{j(!0);try{const{error:k}=await E.from("movies").update(a).in("id",q);if(k)throw k;R(f,"success"),await Z(),p([])}catch(k){console.error("Bulk update failed:",k),R("فشل التحديث الجماعي.","error")}finally{j(!1),m(null)}},n=async a=>{await re({movie_type:a,is_kurdish:a==="kurdish"},"تم تغيير النوع بنجاح.")},t=async()=>{j(!0);try{const{error:a}=await E.from("movies").delete().in("id",q);if(a)throw a;R(`تم حذف ${q.length} فيلم بنجاح.`,"success"),await Z(),p([])}catch(a){console.error("Bulk delete failed:",a),R("فشل الحذف الجماعي.","error")}finally{j(!1),m(null)}},l=async(a,f)=>{j(!0);try{const{data:k,error:H}=await E.from("movies").select("id, genres").in("id",q);if(H)throw H;const ge=k.map(je=>{const ve=je.genres||[];let pe;return f==="add"?pe=[...new Set([...ve,a])]:pe=ve.filter($e=>$e!==a),{id:je.id,genres:pe}}),{error:we}=await E.from("movies").upsert(ge);if(we)throw we;R(`تم ${f==="add"?"إضافة":"إزالة"} فئة "${a}" بنجاح.`,"success"),await Z(),p([])}catch(k){console.error("Bulk genre change failed:",k),R("فشل تغيير الفئة الجماعي.","error")}finally{j(!1),m(null)}},g=async(a,f)=>{j(!0);try{const{data:k,error:H}=await E.from("movies").select("id, tags").in("id",q);if(H)throw H;const ge=k.map(je=>{const ve=je.tags||[];let pe;return f==="add"?pe=[...new Set([...ve,a])]:pe=ve.filter($e=>$e!==a),{id:je.id,tags:pe}}),{error:we}=await E.from("movies").upsert(ge);if(we)throw we;R(`تم ${f==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${a}" بنجاح.`,"success"),await Z(),p([])}catch(k){console.error("Bulk tags change failed:",k),R("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{j(!1),m(null)}},w=o.filter(a=>v==="all"?!0:v==="foreign"?a.movie_type==="foreign"||!a.movie_type:v==="kurdish"?a.movie_type==="kurdish"||a.is_kurdish===!0:a.movie_type===v).filter(a=>gt(D,a.title)),A=Math.ceil(w.length/ze),J=w.slice((d-1)*ze,d*ze),ae=J.length>0&&J.every(a=>q.includes(a.id)),me=a=>{var k;let f=a.movie_type;return!f&&a.is_kurdish?f="kurdish":f||(f="foreign"),((k=nt.find(H=>H.key===f))==null?void 0:k.label)||f};return M?e.jsx(pt,{}):e.jsxs("div",{className:"relative",children:[$&&e.jsx(ut,{...$,onClose:()=>B(null)}),e.jsx(_e,{isOpen:te,onClose:()=>C(!1),onConfirm:L,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',O==null?void 0:O.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:U}),G==="delete"&&e.jsx(_e,{isOpen:!0,onClose:()=>m(null),onConfirm:t,title:`تأكيد حذف ${q.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:U}),G==="genre"&&e.jsx(ft,{genres:h,onClose:I,onSubmit:l,isLoading:U}),G==="tags"&&e.jsx(bt,{onClose:I,onSubmit:g,isLoading:U}),G==="year"&&e.jsx(St,{onClose:I,onSubmit:a=>re({year:a},"تم تحديث السنة بنجاح."),isLoading:U}),G==="changeType"&&e.jsx(_t,{movieTypes:nt,onClose:I,onSubmit:n,isLoading:U}),b&&e.jsx(Ee,{title:u?"تعديل الفيلم":"إضافة فيلم جديد",onClose:I,isOpen:b,children:e.jsx(Nt,{onSubmit:u?a=>ue(u.id,a):ke,initialData:u,onCancel:I,isLoading:U,allGenres:h})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:Y,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:D,onChange:a=>V(a.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("select",{value:v,onChange:a=>T(a.target.value),className:"w-full sm:w-auto bg-slate-700 text-white p-2.5 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors flex-shrink-0","aria-label":"Filter by movie type",children:[e.jsx("option",{value:"all",children:"كل الأنواع"}),nt.map(a=>e.jsx("option",{value:a.key,children:a.label},a.key))]})]}),q.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[q.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>p([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>m("changeType"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير النوع"}),e.jsx("button",{onClick:()=>m("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>m("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>m("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>m("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:le,checked:ae,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"نوع الفيلم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:J.map(a=>{var f,k;return e.jsxs("tr",{className:`${q.includes(a.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:q.includes(a.id),onChange:()=>ee(a.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:a.poster_url,alt:a.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:a.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:a.imdb_rating?a.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:a.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(f=a.genres)==null?void 0:f.slice(0,3).map(H=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:H},H)),((k=a.genres)==null?void 0:k.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:me(a)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:a.created_at?new Date(a.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>z(a),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>N(a),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},a.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:le,checked:ae,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),J.map(a=>{var f,k;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${q.includes(a.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:a.poster_url,alt:a.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:a.title}),e.jsx("input",{type:"checkbox",checked:q.includes(a.id),onChange:()=>ee(a.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:a.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:a.imdb_rating?a.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{children:me(a)})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(f=a.genres)==null?void 0:f.slice(0,2).map(H=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:H},H)),((k=a.genres)==null?void 0:k.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",a.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",a.created_at?new Date(a.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>z(a),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>N(a),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},a.id)})]})]}),w.length>ze&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(dt,{currentPage:d,totalPages:A,onPageChange:y})})]})},Ft=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Mt=({onSubmit:o,initialData:r,onCancel:u,isLoading:c=!1,allGenres:b=[]})=>{const[s,d]=i.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"FullHD"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[y,v]=i.useState(""),[T,D]=i.useState(!1),V=i.useRef(null);i.useEffect(()=>{r&&(d({...r,genres:r.genres||[],tags:r.tags||[],seasons:r.seasons&&r.seasons.length>0?r.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:r.poster_url,year:r.year,episodes:[],imdb_rating:0}],trailer_url:r.trailer_url||"",imdb_rating:r.imdb_rating||0}),v((r.tags||[]).join(", ")))},[r]),i.useEffect(()=>{const m=h=>{V.current&&!V.current.contains(h.target)&&D(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const te=async m=>{var h;try{if(!((h=navigator.clipboard)!=null&&h.readText))throw new Error("Clipboard API not available.");const x=await navigator.clipboard.readText();x&&m(x)}catch(x){console.error("Failed to read clipboard contents: ",x),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},C=m=>{const{name:h,value:x}=m.target;if(h==="year"||h==="imdb_rating"){const _=parseFloat(x);d(F=>({...F,[h]:isNaN(_)?0:_}))}else d(_=>({..._,[h]:x}))},O=m=>{v(m.target.value)},K=m=>{d(h=>({...h,genres:h.genres.includes(m)?h.genres.filter(x=>x!==m):[...h.genres,m]}))},M=(m,h,x)=>{const _=[...s.seasons],F={..._[m]};if(h==="season_number"||h==="year"||h==="imdb_rating"){const W=typeof x=="string"?parseFloat(x):x;F[h]=isNaN(W)?0:W}else F[h]=x;_[m]=F,d(W=>({...W,seasons:_}))},S=()=>{const m=s.seasons.length>0?Math.max(...s.seasons.map(x=>x.season_number))+1:1,h=s.seasons.length>0?s.seasons[s.seasons.length-1].year:s.year;d(x=>({...x,seasons:[...x.seasons,{season_number:m,title:`الموسم ${m}`,description:"",poster_url:x.poster_url,year:h+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"FullHD"}],imdb_rating:0}]}))},U=m=>{d(h=>({...h,seasons:h.seasons.filter((x,_)=>_!==m)}))},j=(m,h,x,_)=>{const F=[...s.seasons],W=[...F[m].episodes],Z={...W[h]};if(x==="episode_number"){const R=typeof _=="string"?parseFloat(_):_;Z[x]=isNaN(R)?0:R}else Z[x]=_;W[h]=Z,F[m]={...F[m],episodes:W},d(R=>({...R,seasons:F}))},$=m=>{const h=s.seasons[m],x=h.episodes.length>0?Math.max(...h.episodes.map(W=>W.episode_number))+1:1,_={episode_number:x,title:`الحلقة ${x}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"FullHD"},F=s.seasons.map((W,Z)=>Z===m?{...W,episodes:[...W.episodes,_]}:W);d(W=>({...W,seasons:F}))},B=(m,h)=>{const x=s.seasons.map((_,F)=>F===m?{..._,episodes:_.episodes.filter((W,Z)=>Z!==h)}:_);d(_=>({..._,seasons:x}))},q=m=>{m.preventDefault();const h=y.split(",").map(x=>x.trim()).filter(Boolean);o({...s,tags:h})},p="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",G="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:s.title,onChange:C,placeholder:"عنوان المسلسل",required:!0,className:p}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:C,placeholder:"سنة بداية العرض",required:!0,className:p})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:C,placeholder:"وصف المسلسل العام",required:!0,className:`${p} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:C,placeholder:"رابط البوستر الرئيسي",required:!0,className:p}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:C,placeholder:"رابط صورة الخلفية",required:!0,className:p})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:C,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:p}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:C,placeholder:"رابط المقطع الدعائي (اختياري)",className:p})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:V,children:[e.jsx("button",{type:"button",onClick:()=>D(m=>!m),className:`${p} text-right`,children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),T&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:b.map(m=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(m),onChange:()=>K(m),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:m})]},m))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:y,onChange:O,placeholder:"أكشن, إثارة...",className:p})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),s.seasons.map((m,h)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:m.season_number||"",onChange:x=>M(h,"season_number",x.target.value),className:`${G} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>U(h),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:m.title,onChange:x=>M(h,"title",x.target.value),placeholder:"عنوان الموسم",required:!0,className:G}),e.jsx("input",{type:"number",value:m.year||"",onChange:x=>M(h,"year",x.target.value),placeholder:"سنة الموسم",required:!0,className:G}),e.jsx("input",{type:"number",value:m.imdb_rating??"",onChange:x=>M(h,"imdb_rating",x.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:G}),e.jsx("input",{type:"url",value:m.poster_url,onChange:x=>M(h,"poster_url",x.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${G} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:m.description,onChange:x=>M(h,"description",x.target.value),placeholder:"وصف الموسم",required:!0,className:`${G} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",m.season_number,":"]}),m.episodes.map((x,_)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:x.episode_number||"",onChange:F=>j(h,_,"episode_number",F.target.value),placeholder:"رقم",className:`${G} w-16`}),e.jsx("input",{type:"text",value:x.title,onChange:F=>j(h,_,"title",F.target.value),placeholder:"عنوان الحلقة",className:`${G} flex-1`}),e.jsx("button",{type:"button",onClick:()=>B(h,_),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"url",value:x.url,onChange:F=>j(h,_,"url",F.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${G} flex-1`}),e.jsx("button",{type:"button",onClick:()=>te(F=>j(h,_,"url",F)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("select",{value:x.quality||"FullHD",onChange:F=>j(h,_,"quality",F.target.value),className:`${G} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"FullHD",children:"FullHD"}),e.jsx("option",{value:"HD",children:"HD"}),e.jsx("option",{value:"SD",children:"SD"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:x.download_url||"",onChange:F=>j(h,_,"download_url",F.target.value),placeholder:"رابط التحميل (اختياري)",className:`${G} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>te(F=>j(h,_,"download_url",F)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]})]},_)),e.jsx("button",{type:"button",onClick:()=>$(h),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},h)),e.jsx("button",{type:"button",onClick:S,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]})]}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-slate-800/95 backdrop-blur-sm p-4 border-t border-slate-700 flex justify-end gap-4 -mx-6 -mb-6 md:-mx-8 md:-mb-8 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:c,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:c,children:[c&&e.jsx(Ft,{}),r?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},He=10,qt=()=>{const[o,r]=i.useState([]),[u,c]=i.useState(null),[b,s]=i.useState(!1),[d,y]=i.useState(1),[v,T]=i.useState(""),[D,V]=i.useState(!1),[te,C]=i.useState(null),[O,K]=i.useState(!0),[M,S]=i.useState(!1),[U,j]=i.useState(null),[$,B]=i.useState([]),[q,p]=i.useState(null),[G,m]=i.useState([]),h=async()=>{var A;const{data:t,error:l}=await E.from("series").select("*").order("created_at",{ascending:!1});if(l){console.error("Error fetching series: ",l);let J="فشل في تحميل المسلسلات.";l.code==="42501"?J="فشل تحميل المسلسلات: أذونات غير كافية.":(A=l.message)!=null&&A.toLowerCase().includes("network")&&(J="فشل تحميل المسلسلات: مشكلة في الشبكة."),x(J,"error")}else r(t);const{data:g,error:w}=await E.from("categories").select("name").order("name");w?console.error("Error fetching categories: ",w):m(g.map(J=>J.name)),K(!1)};i.useEffect(()=>{K(!0),h();const t=E.channel("admin-series-changes").on("postgres_changes",{event:"*",schema:"public",table:"series"},h).subscribe();return()=>{E.removeChannel(t)}},[]),i.useEffect(()=>{y(1),B([])},[v]);const x=(t,l)=>{j({message:t,type:l})},_=async t=>{S(!0);try{const{error:l}=await E.from("series").insert([{...t,created_at:new Date().toISOString()}]);if(l)throw l;await h(),s(!1),y(1),x("تمت إضافة المسلسل بنجاح.","success")}catch(l){console.error("Error adding series: ",l);let g="حدث خطأ أثناء إضافة المسلسل.";l.code==="23505"?g=`فشل الإضافة: ${l.details||"يوجد مسلسل بنفس البيانات بالفعل."}`:l.code==="42501"?g="فشل الإضافة: أذونات غير كافية. تحقق من قواعد الأمان.":g=`حدث خطأ أثناء إضافة المسلسل: ${l.message}`,x(g,"error")}finally{S(!1)}},F=async(t,l)=>{S(!0);try{const{error:g}=await E.from("series").update(l).eq("id",t);if(g)throw g;await h(),c(null),s(!1),x("تم تحديث المسلسل بنجاح.","success")}catch(g){console.error("Error updating series:",g);let w="حدث خطأ أثناء تحديث المسلسل.";g.code==="23505"?w=`فشل التحديث: ${g.details||"يوجد مسلسل آخر بنفس البيانات."}`:g.code==="42501"?w="فشل التحديث: أذونات غير كافية. تحقق من قواعد الأمان.":w=`حدث خطأ أثناء تحديث المسلسل: ${g.message}`,x(w,"error")}finally{S(!1)}},W=t=>{C(t),V(!0)},Z=async()=>{if(te){S(!0);try{const{error:t}=await E.from("series").delete().eq("id",te.id);if(t)throw t;x("تم حذف المسلسل بنجاح.","success"),await h()}catch(t){console.error("Error deleting series:",t);let l="حدث خطأ أثناء حذف المسلسل.";t.code==="42501"?l="فشل الحذف: أذونات غير كافية. تحقق من قواعد الأمان.":l=`حدث خطأ أثناء حذف المسلسل: ${t.message}`,x(l,"error")}finally{V(!1),C(null),S(!1)}}},R=t=>{c(t),s(!0)},ke=()=>{c(null),s(!0)},ue=()=>{c(null),s(!1),p(null)},N=t=>{B(l=>l.includes(t)?l.filter(g=>g!==t):[...l,t])},L=t=>{t.target.checked?B(re.map(l=>l.id)):B($.filter(l=>!re.some(g=>g.id===l)))},z=async()=>{S(!0);try{const{error:t}=await E.from("series").delete().in("id",$);if(t)throw t;x(`تم حذف ${$.length} مسلسل بنجاح.`,"success"),await h(),B([])}catch(t){console.error("Bulk delete failed:",t),x("فشل الحذف الجماعي.","error")}finally{S(!1),p(null)}},Y=async(t,l)=>{S(!0);try{const{data:g,error:w}=await E.from("series").select("id, genres").in("id",$);if(w)throw w;const A=g.map(ae=>{const me=ae.genres||[],a=l==="add"?[...new Set([...me,t])]:me.filter(f=>f!==t);return{id:ae.id,genres:a}}),{error:J}=await E.from("series").upsert(A);if(J)throw J;x(`تم ${l==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),await h(),B([])}catch(g){console.error("Bulk genre change failed:",g),x("فشل تغيير الفئة الجماعي.","error")}finally{S(!1),p(null)}},I=async(t,l)=>{S(!0);try{const{data:g,error:w}=await E.from("series").select("id, tags").in("id",$);if(w)throw w;const A=g.map(ae=>{const me=ae.tags||[],a=l==="add"?[...new Set([...me,t])]:me.filter(f=>f!==t);return{id:ae.id,tags:a}}),{error:J}=await E.from("series").upsert(A);if(J)throw J;x(`تم ${l==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),await h(),B([])}catch(g){console.error("Bulk tags change failed:",g),x("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{S(!1),p(null)}},ee=o.filter(t=>gt(v,t.title)),le=Math.ceil(ee.length/He),re=ee.slice((d-1)*He,d*He),n=re.length>0&&re.every(t=>$.includes(t.id));return O?e.jsx(pt,{}):e.jsxs("div",{className:"relative",children:[U&&e.jsx(ut,{...U,onClose:()=>j(null)}),e.jsx(_e,{isOpen:D,onClose:()=>V(!1),onConfirm:Z,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',te==null?void 0:te.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:M}),q==="delete"&&e.jsx(_e,{isOpen:!0,onClose:()=>p(null),onConfirm:z,title:`تأكيد حذف ${$.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:M}),q==="genre"&&e.jsx(ft,{genres:G,onClose:ue,onSubmit:Y,isLoading:M}),q==="tags"&&e.jsx(bt,{onClose:ue,onSubmit:I,isLoading:M}),b&&e.jsx(Ee,{title:u?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:ue,isOpen:b,children:e.jsx(Mt,{onSubmit:u?t=>F(u.id,t):_,initialData:u,onCancel:ue,isLoading:M,allGenres:G})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ke,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:v,onChange:t=>T(t.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),$.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[$.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>B([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>p("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>p("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>p("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:L,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:re.map(t=>{var l,g,w;return e.jsxs("tr",{className:`${$.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:()=>N(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(l=t.genres)==null?void 0:l.slice(0,3).map(A=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:A},A)),((g=t.genres)==null?void 0:g.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((w=t.seasons)==null?void 0:w.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>R(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>W(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:L,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),re.map(t=>{var l,g,w;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${$.includes(t.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:t.title}),e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:()=>N(t.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:t.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsxs("span",{children:[((l=t.seasons)==null?void 0:l.length)||0," مواسم"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(g=t.genres)==null?void 0:g.slice(0,2).map(A=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:A},A)),((w=t.genres)==null?void 0:w.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",t.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>R(t),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>W(t),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})]})]}),ee.length>He&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(dt,{currentPage:d,totalPages:le,onPageChange:y})})]})},At=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Tt=({onSubmit:o,initialData:r,onCancel:u,isLoading:c=!1})=>{const[b,s]=i.useState("");i.useEffect(()=>{s(r?r.name:"")},[r]);const d=y=>{y.preventDefault(),b.trim()&&o({name:b})};return e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:b,onChange:y=>s(y.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:c,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:c,children:[c&&e.jsx(At,{}),c?r?"جاري التحديث...":"جاري الإضافة...":r?"تحديث":"إضافة"]})]})]})},Ot=10,Pt=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Ot)].map((o,r)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},r))})]})})}),Dt=({isOpen:o,onClose:r,onSubmit:u,isLoading:c,categories:b})=>{const[s,d]=i.useState(""),[y,v]=i.useState(""),[T,D]=i.useState(""),V=jt.useMemo(()=>b.filter(C=>C.name!==s),[b,s]);i.useEffect(()=>{if(o&&b.length>0){const C=b[0].name;d(C);const O=b.filter(K=>K.name!==C);v(O.length>0?O[0].name:"")}},[o,b]),i.useEffect(()=>{D(s&&y&&s===y?"لا يمكن دمج فئة مع نفسها. الرجاء اختيار فئتين مختلفتين.":"")},[s,y]),i.useEffect(()=>{V.some(C=>C.name===y)||v(V.length>0?V[0].name:"")},[s,V,y]);const te=C=>{C.preventDefault(),!(T||!s||!y)&&u(s,y)};return e.jsx(Ee,{title:"توحيد (دمج) الفئات",onClose:r,isOpen:o,children:e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"سيتم نقل كل المحتوى من الفئة المصدر إلى الفئة الهدف، ثم سيتم حذف الفئة المصدر نهائياً."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"دمج من هذه الفئة (سيتم حذفها):"}),e.jsx("select",{id:"source_category",value:s,onChange:C=>d(C.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",children:b.map(C=>e.jsx("option",{value:C.name,children:C.name},C.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"destination_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"الدمج في هذه الفئة (ستبقى):"}),e.jsx("select",{id:"destination_category",value:y,onChange:C=>v(C.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",disabled:V.length===0,children:V.map(C=>e.jsx("option",{value:C.name,children:C.name},C.id))})]}),T&&e.jsx("p",{className:"text-red-400 text-center text-sm bg-red-500/10 p-2 rounded-md",children:T}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:c,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c||!!T||!s||!y,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[c&&e.jsx(Ne,{}),c?"جاري الدمج...":"تنفيذ الدمج"]})]})]})})},We=10,Lt=({message:o,type:r,onClose:u})=>(i.useEffect(()=>{const s=setTimeout(u,5e3);return()=>clearTimeout(s)},[u]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${r==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:o}),e.jsx("button",{onClick:u,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Bt=({children:o,onClose:r,title:u,isOpen:c})=>{const[b,s]=i.useState(c);return i.useEffect(()=>{if(c){s(!0),document.body.style.overflow="hidden";const d=y=>{y.key==="Escape"&&r()};return window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}}else{const d=setTimeout(()=>{s(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(d)}},[c,r]),b?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${c?"animate-fade-in":"animate-fade-out"}`,onClick:r,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${c?"animate-zoom-in":"animate-zoom-out"}`,onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:u}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),o]})}):null},Rt=()=>{const[o,r]=i.useState([]),[u,c]=i.useState(null),[b,s]=i.useState(!1),[d,y]=i.useState(1),[v,T]=i.useState(!1),[D,V]=i.useState(null),[te,C]=i.useState(!0),[O,K]=i.useState(!1),[M,S]=i.useState(null),[U,j]=i.useState(!1),[$,B]=i.useState(null),q=async()=>{var z;const{data:N,error:L}=await E.from("categories").select("*").order("name");if(L){console.error("Error fetching categories: ",L);let Y="فشل في تحميل الفئات.";L.code==="42501"?Y="فشل تحميل الفئات: أذونات غير كافية.":(z=L.message)!=null&&z.toLowerCase().includes("network")&&(Y="فشل تحميل الفئات: مشكلة في الشبكة."),p(Y,"error")}else r(N);C(!1)};i.useEffect(()=>{C(!0),q();const N=E.channel("admin-categories-changes").on("postgres_changes",{event:"*",schema:"public",table:"categories"},q).subscribe();return()=>{E.removeChannel(N)}},[]);const p=(N,L)=>{S({message:N,type:L})},G=async N=>{K(!0);try{const{error:L}=await E.from("categories").insert([N]);if(L)throw L;p("تمت إضافة الفئة بنجاح!","success"),await q(),s(!1),y(1)}catch(L){console.error("Error adding category: ",L);let z="حدث خطأ أثناء إضافة الفئة.";L.code==="23505"?z=`فشل الإضافة: الفئة "${N.name}" موجودة بالفعل.`:L.code==="42501"?z="فشل الإضافة: أذونات غير كافية.":z=`حدث خطأ أثناء إضافة الفئة: ${L.message}`,p(z,"error")}finally{K(!1)}},m=async(N,L)=>{K(!0);const z=u==null?void 0:u.name,Y=L.name,I=z&&Y&&z!==Y;try{const{error:ee}=await E.from("categories").update(L).eq("id",N);if(ee)throw ee;if(I){p("تم تحديث الفئة. جاري تحديث المحتوى المرتبط...","success");const{data:le,error:re}=await E.from("movies").select("id, genres").contains("genres",[z]);if(re)console.error("Error fetching movies to update:",re),p("تم تحديث الفئة، لكن حدث خطأ أثناء جلب الأفلام للتحديث.","error");else if(le&&le.length>0){const l=le.map(A=>{const J=A.genres.map(ae=>ae===z?Y:ae);return E.from("movies").update({genres:J}).eq("id",A.id)}),w=(await Promise.all(l)).find(A=>A.error);w&&(console.error("Error updating movies with new category:",w.error),p("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض الأفلام.","error"))}const{data:n,error:t}=await E.from("series").select("id, genres").contains("genres",[z]);if(t)console.error("Error fetching series to update:",t),p("تم تحديث الفئة، لكن حدث خطأ أثناء جلب المسلسلات للتحديث.","error");else if(n&&n.length>0){const l=n.map(A=>{const J=A.genres.map(ae=>ae===z?Y:ae);return E.from("series").update({genres:J}).eq("id",A.id)}),w=(await Promise.all(l)).find(A=>A.error);w&&(console.error("Error updating series with new category:",w.error),p("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض المسلسلات.","error"))}p("تم تحديث الفئة والمحتوى المرتبط بنجاح!","success")}else p("تم تحديث الفئة بنجاح!","success");await q(),c(null),s(!1)}catch(ee){if(console.error("Error updating category transaction: ",ee),ee.code==="23505")p(`فشل التحديث: اسم الفئة "${Y}" موجود بالفعل.`,"error");else if(ee.code==="42501")p("فشل التحديث: أذونات غير كافية.","error");else{const le=ee.message||JSON.stringify(ee);p(`حدث خطأ أثناء تحديث الفئة: ${le}`,"error")}}finally{K(!1)}},h=N=>{V(N),T(!0)},x=async()=>{if(D){K(!0);try{const{error:N}=await E.from("categories").delete().eq("id",D.id);if(N)throw N;p("تم حذف الفئة بنجاح!","success"),await q()}catch(N){console.error("Error deleting category: ",N);let L="حدث خطأ أثناء حذف الفئة.";N.code==="42501"?L="فشل الحذف: أذونات غير كافية.":L=`حدث خطأ أثناء حذف الفئة: ${N.message}`,p(L,"error")}finally{T(!1),V(null),K(!1)}}},_=N=>{c(N),s(!0)},F=()=>{c(null),s(!0)},W=()=>{c(null),s(!1)},Z=(N,L)=>{j(!1),B({source:N,dest:L})},R=async()=>{if(!$)return;const{source:N,dest:L}=$;K(!0);try{p("جاري تحديث الأفلام...","success");const{data:z,error:Y}=await E.from("movies").select("id, genres").contains("genres",[N]);if(Y)throw new Error(`Failed to fetch movies: ${Y.message}`);if(z&&z.length>0){const re=z.map(n=>{const t=[...new Set(n.genres.filter(l=>l!==N).concat([L]))];return E.from("movies").update({genres:t}).eq("id",n.id)});await Promise.all(re)}p("جاري تحديث المسلسلات...","success");const{data:I,error:ee}=await E.from("series").select("id, genres").contains("genres",[N]);if(ee)throw new Error(`Failed to fetch series: ${ee.message}`);if(I&&I.length>0){const re=I.map(n=>{const t=[...new Set(n.genres.filter(l=>l!==N).concat([L]))];return E.from("series").update({genres:t}).eq("id",n.id)});await Promise.all(re)}p("جاري حذف الفئة المدمجة...","success");const{error:le}=await E.from("categories").delete().eq("name",N);if(le)throw new Error(`Failed to delete category: ${le.message}`);p("تم دمج الفئات بنجاح!","success"),await q()}catch(z){console.error("Error merging categories: ",z),p(`فشل دمج الفئات: ${z.message}`,"error")}finally{B(null),K(!1)}},ke=Math.ceil(o.length/We),ue=o.slice((d-1)*We,d*We);return te?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Pt,{})]}):e.jsxs("div",{children:[M&&e.jsx(Lt,{...M,onClose:()=>S(null)}),e.jsx(_e,{isOpen:v,onClose:()=>T(!1),onConfirm:x,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',D==null?void 0:D.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:O}),e.jsx(_e,{isOpen:!!$,onClose:()=>B(null),onConfirm:R,title:"تأكيد عملية الدمج",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد دمج الفئة ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.source,'"']})," في الفئة ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.dest,'"']}),"؟",e.jsx("br",{}),e.jsxs("span",{className:"text-yellow-400",children:['سيتم حذف الفئة "',$==null?void 0:$.source,'" نهائياً. لا يمكن التراجع عن هذا الإجراء.']})]}),isLoading:O}),e.jsx(Dt,{isOpen:U,onClose:()=>j(!1),onSubmit:Z,isLoading:O,categories:o}),e.jsx(Bt,{isOpen:b,title:u?"تعديل الفئة":"إضافة فئة جديدة",onClose:W,children:e.jsx(Tt,{onSubmit:u?N=>m(u.id,N):G,initialData:u,onCancel:W,isLoading:O})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:F,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsx("button",{onClick:()=>j(!0),className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"توحيد الفئات"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:o.length>0?ue.map(N=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:N.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>_(N),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>h(N),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},N.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:o.length>0?ue.map(N=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-white",children:N.name}),e.jsxs("div",{className:"flex gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>_(N),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:"تعديل"}),e.jsx("button",{onClick:()=>h(N),className:"text-red-500 hover:text-red-400 text-sm font-medium",children:"حذف"})]})]},N.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 bg-slate-900/50 rounded-lg",children:"لا توجد فئات حالياً."})})]}),o.length>We&&e.jsx("div",{className:"mt-4",children:e.jsx(dt,{currentPage:d,totalPages:ke,onPageChange:y})})]})},Ut=["kurdish","asian","turkish","arabic","classic","dubbed","indian","anime"],ot=o=>{try{return new Date(o).toISOString().split("T")[0]}catch{return new Date().toISOString().split("T")[0]}},Oe=(o,r,u,c)=>`
  <url>
    <loc>${o}</loc>
    <lastmod>${r}</lastmod>
    <changefreq>${u}</changefreq>
    <priority>${c}</priority>
  </url>`,Gt=async()=>{const o="https://afllami.netlify.app",r=ot(new Date().toISOString());let u=`<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">`;u+=Oe(`${o}/`,r,"daily","1.0"),u+=Oe(`${o}/#/series`,r,"daily","0.9"),Ut.forEach(y=>{u+=Oe(`${o}/#/movies/${y}`,r,"weekly","0.8")});const{data:c,error:b}=await E.from("movies").select("id, created_at");if(b)throw console.error("Error fetching movies for sitemap:",b),new Error(`Failed to fetch movies: ${b.message}`);c==null||c.forEach(y=>{u+=Oe(`${o}/#/movie/${y.id}`,ot(y.created_at),"monthly","0.7")});const{data:s,error:d}=await E.from("series").select("id, created_at");if(d)throw console.error("Error fetching series for sitemap:",d),new Error(`Failed to fetch series: ${d.message}`);return s==null||s.forEach(y=>{u+=Oe(`${o}/#/series/${y.id}`,ot(y.created_at),"monthly","0.7")}),u+=`
</urlset>`,u},it=["movies","series","categories"],It=o=>o.replace(/[A-Z]/g,r=>`_${r.toLowerCase()}`),ct=o=>Array.isArray(o)?o.map(r=>ct(r)):o!==null&&typeof o=="object"&&o.constructor===Object?o.hasOwnProperty("seconds")&&o.hasOwnProperty("nanoseconds")&&Object.keys(o).length===2&&typeof o.seconds=="number"&&typeof o.nanoseconds=="number"?new Date(o.seconds*1e3).toISOString():o.hasOwnProperty("_seconds")&&o.hasOwnProperty("_nanoseconds")&&Object.keys(o).length===2&&typeof o._seconds=="number"&&typeof o._nanoseconds=="number"?new Date(o._seconds*1e3).toISOString():Object.keys(o).reduce((r,u)=>{const c=It(u);return r[c]=ct(o[u]),r},{}):o,zt=()=>{const[o,r]=i.useState(!1),[u,c]=i.useState(!1),[b,s]=i.useState(null),[d,y]=i.useState(!1),[v,T]=i.useState(null),D=(M,S)=>{s({message:M,type:S})},V=async()=>{var M;r(!0),D("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const S={};for(const p of it){const{data:G,error:m}=await E.from(p).select("*");if(m)throw m;S[p]=G||[]}const U=JSON.stringify(S,null,2),j=new Blob([U],{type:"application/json"}),$=URL.createObjectURL(j),B=document.createElement("a");B.href=$;const q=new Date().toISOString().slice(0,10);B.download=`supabase-backup-${q}.json`,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL($),D("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(S){console.error("Backup failed:",S);let U="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";S.code==="42501"?U="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات.":(M=S.message)!=null&&M.toLowerCase().includes("network")&&(U="فشل النسخ الاحتياطي: مشكلة في الشبكة. يرجى التحقق من اتصالك بالإنترنت."),D(U,"error")}finally{r(!1)}},te=async()=>{c(!0),D("جاري إنشاء خريطة الموقع...","success");try{const M=await Gt(),S=new Blob([M],{type:"application/xml"}),U=URL.createObjectURL(S),j=document.createElement("a");j.href=U,j.download="sitemap.xml",document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(U),D("تم إنشاء خريطة الموقع وتنزيلها بنجاح!","success")}catch(M){console.error("Sitemap generation failed:",M),D(`فشل إنشاء خريطة الموقع: ${M.message}`,"error")}finally{c(!1)}},C=M=>{var U;const S=(U=M.target.files)==null?void 0:U[0];if(S){const j=new FileReader;j.onload=$=>{var B;try{const q=(B=$.target)==null?void 0:B.result,p=JSON.parse(q);T(p)}catch(q){D("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",q),T(null)}},j.readAsText(S)}},O=()=>{v?y(!0):D("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},K=async()=>{if(y(!1),!!v){r(!0),D("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let M=0,S=[];for(const j of Object.keys(v)){if(!it.includes(j)){S.push(j),console.warn(`Skipping restore for unsupported collection: "${j}"`);continue}const $=v[j];if(Array.isArray($)&&$.length>0){const B=$.map(p=>ct(p)),{error:q}=await E.from(j).upsert(B);if(q)throw console.error(`Error during upsert to "${j}":`,JSON.stringify(q,null,2)),console.error("First failed object (transformed):",JSON.stringify(B[0],null,2)),q;M++}}let U="تمت استعادة البيانات بنجاح!";S.length>0&&(U+=` تم تخطي المجموعات التالية: ${S.join(", ")}.`),M===0&&S.length>0?D(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${S.join(", ")}.`,"error"):M>0?D(U,"success"):D("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(M){console.error("Restore failed:",JSON.stringify(M,null,2));const S=`فشلت عملية الاستعادة: ${M.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;D(S,"error")}finally{r(!1),T(null)}}};return e.jsxs("div",{className:"space-y-12",children:[b&&e.jsx(ut,{...b,onClose:()=>s(null)}),e.jsx(_e,{isOpen:d,onClose:()=>y(!1),onConfirm:K,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:o}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إنشاء خريطة الموقع (Sitemap)"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لتحسين ظهور موقعك في محركات البحث مثل جوجل وحل الأخطاء في Google Search Console، يجب عليك إنشاء ورفع ملف خريطة موقع محدّث."}),e.jsxs("div",{className:"p-4 border-l-4 border-cyan-500 bg-cyan-500/10 text-cyan-300 rounded-md space-y-2 text-sm",children:[e.jsx("strong",{className:"font-bold block",children:"الخطوات بالتفصيل:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"إنشاء الملف:"})," انقر على الزر أدناه لإنشاء وتنزيل ملف ",e.jsx("code",{className:"bg-slate-700 px-1 rounded",children:"sitemap.xml"})," الكامل الذي يحتوي على كل المحتوى الحالي."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"الرفع على Netlify:"}),e.jsxs("ul",{className:"list-disc list-inside pr-4 mt-1",children:[e.jsxs("li",{children:["اذهب إلى ",e.jsx("a",{href:"https://app.netlify.com/",target:"_blank",rel:"noopener noreferrer",className:"text-white underline",children:"لوحة تحكم Netlify"}),"."]}),e.jsx("li",{children:"اختر موقعك (afllami)."}),e.jsx("li",{children:'اذهب إلى قسم "Deploys".'}),e.jsxs("li",{children:["اسحب ملف ",e.jsx("code",{className:"bg-slate-700 px-1 rounded",children:"sitemap.xml"})," الذي نزّلته وأفلته مباشرةً في قائمة الملفات المنشورة (published deploy)."]})]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"التأكد من الرفع:"})," بعد لحظات، حاول زيارة ",e.jsx("a",{href:"/sitemap.xml",target:"_blank",rel:"noopener noreferrer",className:"text-white underline",children:"https://afllami.netlify.app/sitemap.xml"}),". يجب أن ترى ملف XML الكامل، وليس الملف النائب. (ملاحظة: تمت إضافة إعدادات جديدة لضمان عمل هذا بشكل صحيح على Netlify)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"تحديث robots.txt:"})," افتح ملف ",e.jsx("code",{className:"bg-slate-700 px-1 rounded",children:"robots.txt"})," في مشروعك وقم بإزالة علامة التعليق (",e.jsx("code",{className:"bg-slate-700 px-1 rounded",children:"#"}),") من السطر ",e.jsx("code",{className:"bg-slate-700 p-1 rounded mt-1 inline-block",children:"Sitemap: ..."}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"إعادة الإرسال لجوجل:"})," في Google Search Console، اذهب إلى قسم Sitemaps وأعد إرسال ",e.jsx("code",{className:"bg-slate-700 px-1 rounded",children:"sitemap.xml"}),"."]})]})]}),e.jsxs("button",{onClick:te,disabled:u,className:"w-full flex items-center justify-center bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:bg-green-800 disabled:cursor-wait",children:[u&&e.jsx(Ne,{}),u?"جاري الإنشاء...":"1. إنشاء وتنزيل sitemap.xml"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",it.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:V,disabled:o,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[o&&e.jsx(Ne,{}),o?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:C,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:O,disabled:o||!v,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[o&&e.jsx(Ne,{}),o?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},Ye=[{key:"movies",label:"إدارة الأفلام",component:e.jsx($t,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(qt,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Rt,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(zt,{})}],Ht=({label:o,tabKey:r,activeTab:u,onClick:c})=>e.jsx("button",{onClick:()=>c(r),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex-shrink-0 ${u===r?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":u===r,children:o}),Kt=()=>{var b;const[o,r]=i.useState(Ye[0].key),[u]=xt();i.useEffect(()=>{const s=u.get("tab");s&&Ye.some(d=>d.key===s)&&r(s)},[u]);const c=(b=Ye.find(s=>s.key===o))==null?void 0:b.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",role:"tablist",children:Ye.map(s=>e.jsx(Ht,{label:s.label,tabKey:s.key,activeTab:o,onClick:r},s.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-3 sm:p-6 rounded-lg border border-slate-700",children:c})]})};export{Kt as default};
